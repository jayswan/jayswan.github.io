---
layout: post
title: 'Baby Bro, Part 2: Conditionals, Address Types'
date: '2013-01-19T19:19:00.000-07:00'
author: Jay Swan
tags: 
modified_time: '2013-01-19T19:48:53.632-07:00'
blogger_id: tag:blogger.com,1999:blog-5029689981158113588.post-3448788648843789922
blogger_orig_url: http://unroutable.blogspot.com/2013/01/baby-bro-part-2-conditionals-address.html
---

Bro has native types for addresses and networks, making it much easier to work with network data. Today's Baby Bro script shows global variable definition, the use of the address and subnet types, and a simple conditional:<br /><br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14<br />15<br />16</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: grey;"># declaring global variables</span><br /><span style="color: grey;"># no need to put quotes around addr or subnet variable definitions</span><br /><span style="color: green; font-weight: bold;">global</span> ipv4_host<span style="color: #303030;">:</span><span style="color: #303090; font-weight: bold;">addr</span> <span style="color: #303030;">=</span> <span style="color: #6000e0; font-weight: bold;">1.1.1.1</span>; <br /><span style="color: green; font-weight: bold;">global</span> ipv4_net<span style="color: #303030;">:</span><span style="color: #303090; font-weight: bold;">subnet</span> <span style="color: #303030;">=</span> <span style="color: #6000e0; font-weight: bold;">1.1.0.0</span><span style="background-color: #fff0ff; color: black;">/16;</span><br /><span style="color: green; font-weight: bold;">event</span> bro_init()<br />    {   <br />    <span style="color: green; font-weight: bold;">if</span> (ipv4_host <span style="color: black; font-weight: bold;">in</span> ipv4_net)<br />        {   <br />        <span style="color: grey;"># addr and subnet types are autoconverted to strings with fmt </span><br />        <span style="color: green; font-weight: bold;">print</span> fmt(<span style="background-color: #fff0f0;">"%s is in network %s"</span>,ipv4_host,ipv4_net);<br />        }   <br />    <span style="color: green; font-weight: bold;">else</span><br />        {   <br />        <span style="color: green; font-weight: bold;">print</span> fmt(<span style="background-color: #fff0f0;">"host %s is not in network %s"</span>,ipv4_host,ipv4_net);<br />        }   <br />   }   <br /></pre></td></tr></tbody></table></div><br />Running this from the CLI, we get the expected output:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">jswan@so12a:~/bro$ bro addr_net_types.bro <br /><b>1.1.1.1 is in network 1.1.0.0/16</b></span><br /><br />Bro also has several interesting built-in functions for working with network data that we'll explore in upcoming posts. For now, we'll take a look at the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">mask_addr</span> function, which allows you to use Bro as an improvised subnet calculator. You can run a Bro micro-script from the CLI with with&nbsp; the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">-e </span>option, just like the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">-e</span> flag in Perl or the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">-c</span> flag in Python:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">jswan@so12a:~/bro$ bro -e "print mask_addr(10.18.32.199,14);"<br /><b>10.16.0.0/14</b><br />jswan@so12a:~/bro$ bro -e "print mask_addr(10.18.32.199,31);"<br /><b>10.18.32.198/31</b></span><br /><br />Great for those late-night subnetting sessions after too many microbrews!<br /><br />Just in case you were wondering: all of this works natively for IPv6, with some changes to the syntax:<br /><br /><b><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">jswan@so12a:~/bro$ bro -e "print [fe80::1db9] in [fe80::]/64;"<br />T </span></b><span style="color: blue;"># T is the way Bro outputs "True" in a Boolean test</span><br /><br />We'll look at some more IPv6 stuff in an upcoming post.