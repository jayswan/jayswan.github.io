---
layout: post
title: Extracting Traffic from Rolling Capture Files
date: '2015-07-14T11:35:00.000-06:00'
author: Jay Swan
tags: 
modified_time: '2015-07-14T11:37:41.378-06:00'
blogger_id: tag:blogger.com,1999:blog-5029689981158113588.post-4153730260606709996
blogger_orig_url: http://unroutable.blogspot.com/2015/07/extracting-traffic-from-rolling-capture.html
---

Every so often I need to extract a subset of traffic from a set of rolling timestamped pcap files. One common place I do this is with <a href="https://github.com/Security-Onion-Solutions/security-onion" target="_blank">Security Onion</a>; one of the great features of SO is its full-packet-capture feature: you can easily pivot from Snort, Suricata, or Bro logs to a full packet capture view, or download the associated pcap file.<br /><br />But what if you don't have an associated alert or Bro log entry? Or if you're doing pcap on some system that's not as user-friendly as Security Onion, but nonetheless supports rolling captures?<br /><br />The way I usually do this is with <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">find </span>and <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">xargs</span>. Here's an example of my most common workflow, using timestamps as the filtering criteria for <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">find</span>:<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">&gt; find . -newerct "16:07" ! -newerct "16:10" | xargs -I {} tcpdump -r {} -w /tmp/{} host 8.8.8.8</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">&gt; cd /tmp</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">&gt; mergecap -w merged.pcap *.pcap</span></span><br /><br />Translated:<br /><ol><li>Find all files in the current directory created after 16:07 but not created after 16:10. This requires GNU <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">find</span> 4.3.3 or later. It supports many different time and date formats.</li><li>Using <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">xargs</span>, filter each file with the "<span style="font-family: &quot;Courier New&quot;,Courier,monospace;">host 8.8.8.8</span>" BPF expression and write it to <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">/tmp</span> with the same filename.</li><li>Merge all the .pcap files in <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">/tmp</span> into <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">merged.pcap</span>.</li></ol>You can easily modify this workflow to fit other use cases. 