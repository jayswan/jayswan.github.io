---
layout: post
title: 'Baby Bro, Part 3: Containers and Loops'
date: '2013-01-27T16:36:00.001-07:00'
author: Jay Swan
tags: 
modified_time: '2013-01-27T16:36:57.258-07:00'
blogger_id: tag:blogger.com,1999:blog-5029689981158113588.post-3504145324091036830
blogger_orig_url: http://unroutable.blogspot.com/2013/01/baby-bro-part-3-containers-and-loops.html
---

Bro has four main container types, which I'm going to cover in somewhat nontraditional order:<br /><ul><li>tables</li><li>sets</li><li>vectors</li><li>records </li></ul><span style="font-size: large;">Tables</span><br />A table is a collection of indexed key-value pairs: the same idea is referred to as a dictionary, associative array, or hash table in other languages. Here's a simple example that pairs letters with their place in the alphabet:<br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3<br />4<br />5</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: green; font-weight: bold;">event</span> bro_init()<br />    {   <br />    <span style="color: green; font-weight: bold;">local</span> letters <span style="color: #303030;">=</span> <span style="color: #303090; font-weight: bold;">table</span>([<span style="color: #6000e0; font-weight: bold;">1</span>] <span style="color: #303030;">=</span> <span style="background-color: #fff0f0;">"a"</span>, [<span style="color: #6000e0; font-weight: bold;">2</span>] <span style="color: #303030;">=</span> <span style="background-color: #fff0f0;">"b"</span>, [<span style="color: #6000e0; font-weight: bold;">3</span>] <span style="color: #303030;">=</span> <span style="background-color: #fff0f0;">"c"</span>);<br />    <span style="color: green; font-weight: bold;">print</span> letters;<br />    }   <br /></pre></td></tr></tbody></table></div><br />Running it, we get this:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">jswan@so12a:~/bro$ bro tables.bro<br />{<br />[3] = c,<br />[1] = a,<br />[2] = b<br />}</span><br /><br />&nbsp;Note that the output isn't in the same order as the script; in Bro, like in most other languages, hash tables are unordered.<br /><br />Iterating over a table with a "for" loop returns the key, again like other languages:<br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: green; font-weight: bold;">event</span> bro_init()<br />    {<br />    <span style="color: green; font-weight: bold;">local</span> letters <span style="color: #303030;">=</span> <span style="color: #303090; font-weight: bold;">table</span>([<span style="color: #6000e0; font-weight: bold;">1</span>] <span style="color: #303030;">=</span> <span style="background-color: #fff0f0;">"a"</span>, [<span style="color: #6000e0; font-weight: bold;">2</span>] <span style="color: #303030;">=</span> <span style="background-color: #fff0f0;">"b"</span>, [<span style="color: #6000e0; font-weight: bold;">3</span>] <span style="color: #303030;">=</span> <span style="background-color: #fff0f0;">"c"</span>);<br />    <br />    <span style="color: green; font-weight: bold;">for</span> (key <span style="color: black; font-weight: bold;">in</span> letters)<br />        {<br />        <span style="color: green; font-weight: bold;">print</span> letters[key];<br />        }<br />    }<br /></pre></td></tr></tbody></table></div><br />And the output:<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">jswan@so12a:~/bro$ bro tables.bro <br />c<br />b<br />a</span><br /><br />Because we printed only the value associated with the key, we never see the key in the output.<br /><br /><span style="font-size: large;">Sets</span><br />It's common in programming to need a data type that allows one to make a collection of distinct objects, without containing multiple instances of identical objects. This is the mathematical notion of a <a href="https://en.wikipedia.org/wiki/Set_%28mathematics%29" target="_blank">set</a>. Bro has a native set type. Consider an example where you have a large list of IP addresses that you got from some other source: an intel feed, a firewall log, a web server log, etc. You want to get a unique set of addresses that have appeared, but you don't care how many times they appeared. This is the perfect use for a set:<br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: green; font-weight: bold;">event</span> bro_init()<br />    {   <br />    <span style="color: green; font-weight: bold;">local</span> a1 <span style="color: #303030;">=</span> <span style="color: #6000e0; font-weight: bold;">1.1.1.1</span>;<br />    <span style="color: green; font-weight: bold;">local</span> a2 <span style="color: #303030;">=</span> <span style="color: #6000e0; font-weight: bold;">2.2.2.2</span>;<br />    <span style="color: green; font-weight: bold;">local</span> a3 <span style="color: #303030;">=</span> <span style="color: #6000e0; font-weight: bold;">3.3.3.3</span>;<br />    <span style="color: green; font-weight: bold;">local</span> a4 <span style="color: #303030;">=</span> [fe80<span style="color: #0e84b5; font-weight: bold;">::</span>abcd<span style="color: #303030;">:</span><span style="color: #6000e0; font-weight: bold;">1</span>];<br />    <span style="color: green; font-weight: bold;">local</span> a5 <span style="color: #303030;">=</span> <span style="color: #6000e0; font-weight: bold;">2.2.2.2</span>;<br />    <span style="color: green; font-weight: bold;">local</span> a6 <span style="color: #303030;">=</span> <span style="color: #6000e0; font-weight: bold;">2.2.2.2</span>;<br /><span style="color: green; font-weight: bold;"><span style="color: black;">    </span>local</span> unique <span style="color: #303030;">=</span> <span style="color: #303090; font-weight: bold;">set</span>(a1,a2,a3,a4,a5,a6);<br />    <span style="color: green; font-weight: bold;">print</span> unique;<br />    }   <br /></pre></td></tr></tbody></table></div><br />And the output:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">jswan@so12a:~/bro$ bro sets.bro<br />{<br />1.1.1.1,<br />3.3.3.3,<br />2.2.2.2,<br />fe80::abcd:1<br />}</span><br /><br />Note that 2.2.2.2 appears only once in the set, despite having been included three times as different variables.<br /><br /><span style="font-size: large;">Vectors</span><br />A vector is Bro's version of a one dimensional array. Having spent most of my recent programming time in Python, I was surprised to find that Bro vectors work like hash tables for iteration: when you loop over a vector, you get the index into the vector rather than the object itself. Here's an example:<br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3<br />4<br />5<br />6<br />7<br />8</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: green; font-weight: bold;">event</span> bro_init()<br />    {   <br />    <span style="color: green; font-weight: bold;">local</span> animals <span style="color: #303030;">=</span> <span style="color: #303090; font-weight: bold;">vector</span>(<span style="background-color: #fff0f0;">"cat"</span>,<span style="background-color: #fff0f0;">"dog"</span>,<span style="background-color: #fff0f0;">"dinosaur"</span>,<span style="background-color: #fff0f0;">"rat"</span>);<br />    <span style="color: green; font-weight: bold;">for</span> (animal <span style="color: black; font-weight: bold;">in</span> animals)<br />        {   <br />        <span style="color: green; font-weight: bold;">print</span> animal;<br />        }   <br />    }   <br /></pre></td></tr></tbody></table></div><br />The output:<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">jswan@so12a:~/bro$ bro vectors.bro<br />0<br />1<br />2<br />3</span><br /><br />If you want to iterate a vector and get the object, you have to specify the index:<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3<br />4<br />5<br />6<br />7<br />8</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: green; font-weight: bold;">event</span> bro_init()<br />    {<br />    <span style="color: green; font-weight: bold;">local</span> animals <span style="color: #303030;">=</span> <span style="color: #303090; font-weight: bold;">vector</span>(<span style="background-color: #fff0f0;">"cat"</span>,<span style="background-color: #fff0f0;">"dog"</span>,<span style="background-color: #fff0f0;">"dinosaur"</span>,<span style="background-color: #fff0f0;">"rat"</span>);<br />    <span style="color: green; font-weight: bold;">for</span> (index <span style="color: black; font-weight: bold;">in</span> animals)<br />        {<br />        <span style="color: green; font-weight: bold;">print</span> animals[index];<br />        }<br />    }<br /></pre></td></tr></tbody></table></div><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">jswan@so12a:~/bro$ bro vectors.bro<br />cat<br />dog<br />dinosaur<br />rat</span><br /><br />Bro's vectors work pretty much exactly like a table with "counts" as keys (a <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">count</span> is yet another native Bro type that we haven't discussed yet; it's the same as an integer but it's always unsigned; it can't be a negative). In fact, some of the earlier Bro documentation doesn't even show vectors as valid types, so I wonder if they are actually implemented internally as tables.<br /><br /><span style="font-size: large;">Records</span><br />The last Bro container type is the record, which is sort of the meat and potatoes of Bro's wonderful logging tools. Records are discussed in detail in most of the other beginner-Bro material out there, so I'm not going to cover them here.<br /><br />This will probably be the last "Baby Bro" post that I do with just the raw language features demonstrated inside the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">bro_init() </span>event. Any further Bro posts will probably be using Bro in its intended context. Hope this was helpful!